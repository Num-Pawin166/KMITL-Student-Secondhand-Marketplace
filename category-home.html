<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หมวดหมู่ - บ้านและสวน</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    
    <div class="container">
        <header>
            <a href="index.html" class="logo-link" style="font-weight: bold; font-size: 1.2rem;">KMITL Marketplace</a>
            <div class="search-bar">
                <input type="text" placeholder="Search for products...">
            </div>
            <a href="dashboard.html" class="post-item-btn"><i class="fas fa-plus-circle"></i> ลงขายสินค้า</a>
            <div class="header-icons">
                <a href="#" class="icon-link"><i class="fas fa-shopping-cart"></i></a>
                <a href="dashboard.html" class="icon-link"><i class="fas fa-user"></i></a>
            </div>
        </header>
        <main>
            <div class="breadcrumb">
                <a href="index.html">หน้าหลัก</a> > <a href="#">บ้านและสวน</a>
            </div>
            <h1 class="category-title">บ้านและสวน</h1>
            <div class="category-layout">
                <aside class="filter-sidebar">
                    <h3><i class="fas fa-filter"></i> กรองสินค้า</h3>
                    <div class="filter-section">
                        <label for="keyword-search">ค้นหาด้วยคำสำคัญ</label>
                        <input type="text" id="keyword-search" placeholder="เช่น โต๊ะ, ต้นไม้...">
                    </div>
                    <div class="filter-section">
                        <label>ช่วงราคา</label>
                        <div class="price-inputs">
                            <input type="number" placeholder="ต่ำสุด" min="0">
                            <span>-</span>
                            <input type="number" placeholder="สูงสุด" min="0">
                        </div>
                    </div>
                    <div class="filter-section">
                        <label>ประเภทสินค้า</label>
                        <div class="category-filter-list">
                            <a href="#">ทั้งหมด</a>
                            <a href="#">เฟอร์นิเจอร์</a>
                            <a href="#">ของตกแต่ง</a>
                            <a href="#">อุปกรณ์ทำสวน</a>
                        </div>
                    </div>
                    <button class="filter-button">ใช้ตัวกรอง</button>
                </aside>
                <div class="category-content">
                    <section class="products-section category-page-products">
                        <div class="product-grid" id="product-grid">
                        <div class="product-grid">
                           <a href="#" class="product-card">
                                <img src="https://i.imgur.com/pP40f8X.png" alt="ตะเกียงน้ำมันวินเทจ">
                                <div class="product-card-info">
                                    <h3>ตะเกียงน้ำมันวินเทจ</h3>
                                    <p>390 B</p>
                                </div>
                            </a>
                        </div>
                    </section>
                    <nav class="pagination">
                        <a href="#" class="page-arrow">← ย้อนกลับ</a>
                        <a href="#" class="page-number active">1</a>
                        <a href="#" class="page-arrow">ถัดไป →</a>
                    </nav>
                </div>
            </div>
        </main>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        // --- ▼▼▼ [สำคัญ] แก้ไขแค่บรรทัดนี้ในแต่ละไฟล์ ▼▼▼ ---
        const categoryName = 'home'; // << สำหรับไฟล์ category-appliances.html
        // const categoryName = 'clothing'; // << สำหรับไฟล์ category-clothing.html
        // const categoryName = 'health';   // << สำหรับไฟล์ category-health.html
        // const categoryName = 'home';     // << สำหรับไฟล์ category-home.html
        
        const productGrid = document.getElementById('product-grid');

        try {
            // ยิง request ไปที่ API ใหม่ของเรา โดยระบุชื่อหมวดหมู่
            const response = await fetch(`http://localhost:5000/api/products/category/${categoryName}`);
            
            if (!response.ok) {
                throw new Error(`เกิดข้อผิดพลาด: ${response.status}`);
            }
            
            const products = await response.json();

            // ลบสินค้าตัวอย่างที่แสดงอยู่ทิ้ง
            productGrid.innerHTML = '';

            if (products.length === 0) {
                productGrid.innerHTML = `<p style="text-align: center; width: 100%;">ไม่พบสินค้าในหมวดหมู่นี้</p>`;
                return;
            }

            // วนลูปสร้างการ์ดสินค้าใหม่จากข้อมูลที่ได้มา
            products.forEach(product => {
                const productCard = document.createElement('a');
                // ในอนาคตอาจจะลิงก์ไปหน้า product detail
                productCard.href = '#'; 
                productCard.className = 'product-card';

                const imageUrl = product.image_urls && product.image_urls.length > 0
                    ? `/${product.image_urls[0]}` // สร้าง URL เต็ม
                    : 'https://via.placeholder.com/250'; // รูปสำรอง

                productCard.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name}">
                    <div class="product-card-info">
                        <h3>${product.name}</h3>
                        <p>${product.price} B</p>
                    </div>
                `;
                productGrid.appendChild(productCard);
            });

        } catch (error) {
            console.error(`Error fetching products for category '${categoryName}':`, error);
            productGrid.innerHTML = '<p style="text-align: center; width: 100%;">เกิดข้อผิดพลาดในการโหลดข้อมูลสินค้า</p>';
        }
    });
</script>
</body>
</html>