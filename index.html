<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMITL Student Secondhand Marketplace</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="container">
        <header>
            <a href="index.html" class="logo-link" style="font-weight: bold; font-size: 1.2rem;">KMITL Marketplace</a>
            <div class="search-bar">
                <input type="text" placeholder="Search for products...">
            </div>
            <a href="dashboard.html" class="post-item-btn"><i class="fas fa-plus-circle"></i> ลงขายสินค้า</a>
            <div class="header-icons">
                <a href="#" class="icon-link"><i class="fas fa-shopping-cart"></i></a>
                <a href="dashboard.html" class="icon-link"><i class="fas fa-user"></i></a>
            </div>
        </header>

        <main>
            <section class="hero">
                <h1>KMITL Student <br> Secondhand Marketplace</h1>
                <div class="hero-diamond"></div>
                <p>พื้นที่กลางสำหรับนักศึกษาโพสต์ขาย/ค้นหาสินค้ามือสองในรั้วมหาวิทยาลัย เพื่อความสะดวก ปลอดภัย และลดของเสีย</p>
                <button class="hero-button">ซื้อเลย !!!</button>
            </section>
        </main>
    </div>

    <div class="banner"></div>

    <div class="container">
        <section class="category-section">
            <h2>หมวดหมู่</h2>
            <div class="category-grid">
                <a href="category-clothing.html" class="category-card">
                    <h3>เสื้อผ้า</h3>
                    <img src="images/clothes.jpg" alt="เสื้อผ้า">
                </a>
                <a href="category-appliances.html" class="category-card">
                    <h3>เครื่องใช้ไฟฟ้า</h3>
                    <img src="images/appliances.jpg" alt="เครื่องใช้ไฟฟ้า">
                </a>
                <a href="category-home.html" class="category-card">
                    <h3>บ้านและสวน</h3>
                    <img src="images/home.jpg" alt="บ้านและสวน">
                </a>
                <a href="category-health.html" class="category-card">
                    <h3>สุขภาพและความงาม</h3>
                    <img src="images/health.jpg" alt="สุขภาพและความงาม">
                </a>
            </div>
        </section>
    </div>

    <div class="container">
        <section class="products-section">
            <h2>สินค้าใหม่</h2>
            <div class="product-grid" id="new-products-grid">
                </div>
            <div class="view-more-container">
                <button class="view-more-btn button-style">เพิ่มเติม</button>
            </div>
        </section>

        <section class="products-section">
            <h2>อื่นๆ</h2>
            <div class="product-grid">
                </div>
            <div class="view-more-container">
                <button class="view-more-btn button-style">เพิ่มเติม</button>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const newProductsGrid = document.getElementById('new-products-grid');

            try {
                // ดึงสินค้าทั้งหมด (ซึ่งตอนนี้เรียงตามวันที่ล่าสุดแล้ว)
                const response = await fetch('http://localhost:5000/api/products');
                if (!response.ok) throw new Error('ไม่สามารถโหลดข้อมูลได้');
                
                const allProducts = await response.json();

                // ลบสินค้าตัวอย่างทิ้ง
                newProductsGrid.innerHTML = '';

                // แสดงสินค้าแค่ 8 ชิ้นล่าสุด
                const latestProducts = allProducts.slice(0, 8);

                if (latestProducts.length === 0) {
                    newProductsGrid.innerHTML = '<p>ยังไม่มีสินค้าใหม่ในระบบ</p>';
                    return;
                }

                // วนลูปสร้างการ์ดสินค้า
                latestProducts.forEach(product => {
                    const productCard = document.createElement('a');
                    productCard.href = '#'; // ในอนาคตอาจจะลิงก์ไปหน้า product detail
                    productCard.className = 'product-card';

                    const imageUrl = product.image_urls && product.image_urls.length > 0
                        ? `/${product.image_urls[0]}`
                        : 'https://via.placeholder.com/250';

                    productCard.innerHTML = `
                        <img src="${imageUrl}" alt="${product.name}">
                        <div class="product-card-info">
                            <h3>${product.name}</h3>
                            <p>${product.price} B</p>
                        </div>
                    `;
                    newProductsGrid.appendChild(productCard);
                });

            } catch (error) {
                console.error('Error fetching new products:', error);
                newProductsGrid.innerHTML = '<p>เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
            }
        });
    </script>
</body>
</html>